<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ’ Pink Proposal â€” 40 Languages + Romantic Celebration</title>

<style>
:root{
  --pink-1:#ffdee9;
  --pink-2:#ffb6d9;
  --accent:#ff4fa3;
  --dark:#2b0018;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  height:100vh;
  overflow-x:hidden;
  color:var(--pink-1);
  background: linear-gradient(120deg, #2b0018 0%, #3a0026 50%, #4a0033 100%);
  animation: bgShift 12s infinite alternate ease-in-out;
  text-align:center;
}
body::before{
  content:"";
  position:fixed;
  inset: 6px;
  border-radius:18px;
  box-shadow: 0 0 30px rgba(255,80,150,0.25);
  pointer-events:none;
}
@keyframes bgShift{
  0%{filter: hue-rotate(0deg) brightness(0.95)}
  50%{filter: hue-rotate(8deg) brightness(1.05)}
  100%{filter: hue-rotate(-6deg) brightness(1)}
}
.container{
  width:92%;
  max-width:920px;
  margin: 48px auto;
  padding: 28px;
  border-radius:16px;
  backdrop-filter: blur(6px);
  position:relative;
}
.screen{ display:none; padding:6px; }
.screen.active{ display:block; animation: screenIn 550ms ease; }
@keyframes screenIn{ from{opacity:0; transform: translateY(18px)} to{opacity:1; transform:none} }

.heading{
  font-size:20px;
  color:var(--pink-2);
  margin:8px 0 18px;
  text-shadow: 0 0 10px rgba(255,80,150,0.18);
}
.typewriter{
  font-size:26px;
  font-weight:700;
  color:var(--accent);
  display:inline-block;
  white-space:pre-wrap;
  text-align:center;
  border-right: 2px solid rgba(255,140,190,0.8);
  padding-right:6px;
  margin-bottom:16px;
}
.inputs{ margin:18px 0; }
input[type="text"]{
  width:240px;
  padding:12px 14px;
  border-radius:10px;
  border:2px solid rgba(255,120,170,0.22);
  background: rgba(255,255,255,0.03);
  color:#fff;
  font-size:16px;
  margin:8px;
}
.btn{
  display:inline-block;
  background: linear-gradient(180deg, #ff6fa5, #ff3b86);
  color:white;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  cursor:pointer;
  font-size:16px;
  margin:8px 6px;
  box-shadow: 0 6px 20px rgba(255,70,140,0.18);
  transition: transform .18s ease, box-shadow .18s ease;
}
.btn:active{ transform: translateY(2px); }
.btn:hover{ transform: translateY(-3px); box-shadow: 0 14px 32px rgba(255,60,140,0.28); }

.controls{
  margin-top:14px;
  display:flex;
  gap:8px;
  justify-content:center;
  flex-wrap:wrap;
}
.loveCount{
  font-size:42px;
  font-weight:800;
  color:#ff2a8e;
  text-shadow: 0 0 24px rgba(255,60,140,0.3);
  margin:12px 0;
}
.langList{ text-align:left; margin:18px auto; max-width:720px; color:#ffdfe9; }

/* effects */
.heart, .star, .petal {
  position:fixed;
  pointer-events:none;
  z-index:2;
  user-select:none;
}
.heart{ animation: floatUp 6s linear infinite; color:#ff77aa; font-size:22px; opacity:0.92; }
@keyframes floatUp { 0%{transform:translateY(0) rotate(0)} 100%{transform:translateY(-110vh) rotate(45deg); opacity:0} }
.star{ animation: starFloat 9s linear infinite; color:#ffd6f0; font-size:12px; opacity:0.8; }
@keyframes starFloat { 0%{transform:translateY(0) scale(0.9)} 100%{transform:translateY(-100vh) scale(1.2); opacity:0} }
.petal{ animation: petalFall linear infinite; font-size:26px; opacity:0.95; }
@keyframes petalFall { 0%{transform:translateY(-10px) rotate(0)} 100%{transform:translateY(110vh) rotate(360deg); opacity:0} }
.clickHeart{
  position:fixed; transform:translate(-50%,-50%); animation: clickUp 900ms ease forwards; font-size:20px; z-index:6;
}
@keyframes clickUp{ 0%{transform:translate(-50%,-50%) translateY(0) scale(1); opacity:1} 100%{transform:translate(-50%,-50%) translateY(-80px) scale(1.6); opacity:0} }

.burstHeart{
  position:absolute;
  transform-origin:center;
  animation: burstAnim 1100ms ease-out forwards;
  font-size:24px;
  z-index:8;
}
@keyframes burstAnim{
  0%{opacity:1; transform:scale(0.3) translateY(0)}
  60%{opacity:1; transform:scale(1.05) translateY(-40px)}
  100%{opacity:0; transform:scale(1.6) translateY(-120px)}
}
.confettiPiece{
  position:fixed;
  width:10px; height:14px; z-index:9;
  border-radius:2px;
  animation: confettiFall linear forwards;
}
@keyframes confettiFall{
  0%{transform:translateY(-10vh) rotate(0); opacity:1}
  100%{transform:translateY(110vh) rotate(720deg); opacity:0}
}
.celebrate{
  padding:28px;
  border-radius:16px;
  background: linear-gradient(180deg, rgba(255,200,240,0.04), rgba(255,120,170,0.02));
  box-shadow: 0 10px 40px rgba(255,30,120,0.06);
}
.celebrate .bigText{
  font-size:46px;
  font-weight:900;
  color:#ffecf6;
  text-shadow: 0 6px 30px rgba(255,100,170,0.28);
}
.celebrate .subText{
  font-size:18px;
  color:#ffdff0;
  margin-top:6px;
}
.roseFloat{
  position:fixed; right:10px; bottom:10px; opacity:0.12; width:140px; transform:rotate(-8deg);
  filter: drop-shadow(0 10px 20px rgba(255,60,140,0.06));
  z-index:1; pointer-events:none;
}
.poemBox{
  margin:18px auto;
  max-width:820px;
  color:#ffdfe9;
  font-size:18px;
  line-height:1.5;
  background: rgba(255,255,255,0.02);
  padding:14px;
  border-radius:10px;
  box-shadow: inset 0 0 18px rgba(255,80,150,0.02);
  text-align:center;
  font-style:italic;
}
@media (max-width:520px){
  .typewriter{ font-size:20px; border-right:2px solid rgba(255,140,190,0.8) }
  .bigText{ font-size:34px }
  input[type="text"]{ width:88%; }
}
</style>
</head>
<body>

<div class="container">
  <div style="margin-bottom:6px">
    <div class="heading">ğŸ’– Romantic Proposal Generator â€” 40 Languages & Celebration ğŸ’–</div>
  </div>

  <!-- SCREEN 1 -->
  <div id="screen1" class="screen active">
    <div class="typewriter">Enter details to create a personalized proposal</div>
    <div class="inputs" style="margin-top:12px">
      <input id="fromInput" type="text" placeholder="Your Name (e.g. Ivan)">
      <input id="toInput" type="text" placeholder="Partner Name (e.g. Riya)">
    </div>

    <div>
      <button class="btn" onclick="generateProposal()">Generate Proposal</button>
      <button class="btn" onclick="fillExample()">Try Example</button>
    </div>

    <div class="controls" style="margin-top:10px">
      <button class="btn" id="musicToggle" onclick="toggleMusic()">ğŸ”ˆ Music: Off</button>
      <button class="btn" onclick="copyCurrentURL()">ğŸ”— Copy Current Link</button>
    </div>
  </div>

  <!-- SCREEN 2 -->
  <div id="screen2" class="screen">
    <div id="type1" class="typewriter"></div>
    <div style="margin-top:18px">
      <button class="btn" onclick="goToStep2()">CLICK BUTTON</button>
      <button class="btn" onclick="goBack(1)">âŸµ Edit Names</button>
    </div>
  </div>

  <!-- SCREEN 3 -->
  <div id="screen3" class="screen">
    <div id="type2" class="typewriter"></div>
    <div style="margin-top:18px">
      <button class="btn" id="yesBtn" onclick="yesClick()">YES / ğá´€ğ¤ğ¤á´€ ğá´€á´€?</button>
      <button class="btn" onclick="goBack(2)">âŸµ Back</button>
    </div>
  </div>

  <!-- SCREEN 4 -->
  <div id="screen4" class="screen">
    <div class="loveCount" id="loveCounter">0 â¤ï¸</div>

    <div style="margin-top:12px">
      <button class="btn" onclick="showCelebrate()">Celebrate!</button>
      <button class="btn" id="waShareBtn" onclick="shareWhatsApp()">Share on WhatsApp</button>
      <button class="btn" onclick="copyProposalLink()">Copy Proposal Link</button>
      <button class="btn" onclick="showScreen('screenLang')">View 40 Languages</button>
    </div>

    <div style="margin-top:14px; font-size:14px; color:#ffdfe9">
      Share the link or send on WhatsApp to the person you love.
    </div>
  </div>

  <!-- SCREEN 5: Celebration (Option B) -->
  <div id="screen5" class="screen celebrate" style="display:none">
    <img class="roseFloat" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400'><text x='0' y='120' font-size='120'>ğŸŒ¹</text></svg>" alt="rose"/>
    <div class="bigText" id="celebrateTitle">She Said YES ğŸ’ğŸ’–</div>
    <div class="subText" id="celebrateSub">A new chapter begins â€” love, laughter & forever.</div>

    <!-- POEM inserted here as requested (on final celebration page) -->
    <div class="poemBox" id="poemBox">
      <div style="font-weight:700; margin-bottom:6px; color:#ffcce3">A line from the heart</div>
      <div id="poemText">Tum chhodo bhii kuchh kehne ko..<br>Mein kehta huu mujhe kehne do..<br>Ek-tarfa ishq hii behtar hai..<br>Mai krta huu tum rehne do..</div>
    </div>

    <div style="margin:18px 0;">
      <button class="btn" onclick="downloadScreenshot()">ğŸ’¾ Save Screenshot</button>
      <button class="btn" onclick="shareWhatsApp(true)">ğŸ“² Share This Celebration</button>
      <button class="btn" onclick="resetAll()">ğŸ” Start New Proposal</button>
    </div>
  </div>

  <!-- SCREEN LANG: 40 languages -->
  <div id="screenLang" class="screen">
    <div class="heading">ğŸ’— 40-Language Proposals</div>
    <div class="langList">
      1. English: Will you marry me?<br>
      2. Hindi: à¤•à¥à¤¯à¤¾ à¤¤à¥à¤® à¤®à¥à¤à¤¸à¥‡ à¤¶à¤¾à¤¦à¥€ à¤•à¤°à¥‹à¤—à¥€?<br>
      3. Urdu: Ú©ÛŒØ§ ØªÙ… Ù…Ø¬Ú¾ Ø³Û’ Ø´Ø§Ø¯ÛŒ Ú©Ø±Ùˆ Ú¯ÛŒØŸ<br>
      4. Bengali: à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦†à¦®à¦¾à¦•à§‡ à¦¬à¦¿à¦¯à¦¼à§‡ à¦•à¦°à¦¬à§‡?<br>
      5. Gujarati: àª¶à«àª‚ àª¤àª®à«‡ àª®àª¾àª°à«€ àª¸àª¾àª¥à«‡ àª²àª—à«àª¨ àª•àª°àª¶à«‹?<br>
      6. Marathi: à¤¤à¥‚ à¤®à¤¾à¤à¥à¤¯à¤¾à¤¶à¥€ à¤²à¤—à¥à¤¨ à¤•à¤°à¤¶à¥€à¤² à¤•à¤¾?<br>
      7. Tamil: à®à®©à¯à®©à¯à®Ÿà®©à¯ à®¤à®¿à®°à¯à®®à®£à®®à¯ à®šà¯†à®¯à¯à®•à®¿à®±à®¤à®¾?<br>
      8. Telugu: à°¨à°¾à°¤à±‹ à°µà°¿à°µà°¾à°¹à°‚ à°šà±‡à°¸à±à°•à±à°‚à°Ÿà°¾à°µà°¾?<br>
      9. Kannada: à²¨à²¿à²¨à³à²¨à³Šà²¡à²¨à³† à²®à²¦à³à²µà³†à²¯à²¾à²—à³à²¤à³à²¤à³€à²¯à²¾?<br>
      10. Malayalam: à´¨àµ€ à´à´¨àµà´¨àµ‹à´Ÿàµ à´µà´¿à´µà´¾à´¹à´‚ à´šàµ†à´¯àµà´¯àµà´®àµ‹?<br>
      11. Punjabi: à¨•à©€ à¨¤à©à¨¸à©€à¨‚ à¨®à©‡à¨°à©‡ à¨¨à¨¾à¨² à¨µà¨¿à¨†à¨¹ à¨•à¨°à©‹à¨—à©‡?<br>
      12. Nepali: à¤•à¥‡ à¤¤à¤¿à¤®à¥€ à¤®à¥‡à¤°à¥‹ à¤µà¤¿à¤µà¤¾à¤¹ à¤—à¤°à¥à¤¨à¥‡à¤›à¥Œ?<br>
      13. Sinhala: à¶”à¶¶ à¶¸à·à·€ à·€à·’à·€à·à·„ à¶šà¶»à¶¸à·”à¶¯?<br>
      14. Arabic: Ù‡Ù„ ØªÙ‚Ø¨Ù„/ÙŠÙ† Ø§Ù„Ø²ÙˆØ§Ø¬ Ø¨ÙŠØŸ<br>
      15. Turkish: Benimle evlenir misin?<br>
      16. French: Veux-tu mâ€™Ã©pouser ?<br>
      17. Spanish: Â¿Te casarÃ­as conmigo?<br>
      18. German: Willst du mich heiraten?<br>
      19. Italian: Vuoi sposarmi?<br>
      20. Filipino (Tagalog): Pakakasalan mo ba ako?<br>
      21. Indonesian: Mau menikah denganku?<br>
      22. Thai: à¸„à¸¸à¸“à¸ˆà¸°à¹à¸•à¹ˆà¸‡à¸‡à¸²à¸™à¸à¸±à¸šà¸‰à¸±à¸™à¹„à¸«à¸¡?<br>
      23. Burmese: á€™á€„á€ºá€¸á€€á€€á€»á€½á€”á€ºá€á€±á€¬á€·á€ºá€”á€²á€·á€œá€€á€ºá€‘á€•á€ºá€á€»á€„á€ºá€˜á€°á€¸á€œá€¬á€¸?<br>
      24. Korean: ë‚˜ì™€ ê²°í˜¼í•´ ì¤„ë˜ìš”?<br>
      25. Japanese: ç§ã¨çµå©šã—ã¦ãã‚Œã¾ã™ã‹ï¼Ÿ<br>
      26. Chinese (Mandarin): ä½ æ„¿æ„å«ç»™æˆ‘å—ï¼Ÿ/ä½ æ„¿æ„å¨¶æˆ‘å—ï¼Ÿ<br>
      27. Russian: Ğ²Ñ‹Ğ¹Ğ´ĞµÑˆÑŒ Ğ·Ğ° Ğ¼ĞµĞ½Ñ Ğ·Ğ°Ğ¼ÑƒĞ¶?<br>
      28. Portuguese: VocÃª quer se casar comigo?<br>
      29. Vietnamese: Em cÃ³ láº¥y anh khÃ´ng?<br>
      30. Persian (Farsi): Ø¢ÛŒØ§ Ø¨Ø§ Ù…Ù† Ø§Ø²Ø¯ÙˆØ§Ø¬ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ<br>
      31. Hebrew: ×”×× ×ª×ª×—×ª× ×™ ××™×ª×™?<br>
      32. Swahili: Utaniolewa nami?<br>
      33. Polish: Czy wyjdziesz za mnie?<br>
      34. Dutch: Wil je met me trouwen?<br>
      35. Greek: Î˜ÎµÏ‚ Î½Î± Î¼Îµ Ï€Î±Î½Ï„ÏÎµÏ…Ï„ÎµÎ¯Ï‚;<br>
      36. Romanian: Vrei sÄƒ te cÄƒsÄƒtoreÈ™ti cu mine?<br>
      37. Czech: VezmeÅ¡ si mÄ›?<br>
      38. Hungarian: HozzÃ¡m jÃ¶ssz felesÃ©gÃ¼l?<br>
      39. Malay: Mahukah kamu berkahwin denganku?<br>
      40. Bulgarian: Ğ©Ğµ ÑĞµ Ğ¾Ğ¼ÑŠĞ¶Ğ¸Ñˆ Ğ»Ğ¸ Ğ·Ğ° Ğ¼ĞµĞ½?<br>
    </div>
    <div style="margin-top:12px"><button class="btn" onclick="showScreen('screen1')">âŸµ Back Home</button></div>
  </div>

</div> <!-- /container -->

<!-- AUDIO: Proposal music (Tu Maan Meri Jaan placeholder) -->
<audio id="proposalMusic" loop preload="auto">
  <!-- Replace with your hosted file if you have the song -->
  <source src="https://files.catbox.moe/0p8z4m.mp3" type="audio/mpeg">
</audio>

<!-- AUDIO: Celebration music (soft slow love) -->
<audio id="celebrationMusic" loop preload="auto">
  <source src="https://files.catbox.moe/1j3k9p.mp3" type="audio/mpeg">
</audio>

<div id="fxRoot"></div>

<script>
/* Globals */
const screens = {
  s1: document.getElementById('screen1'),
  s2: document.getElementById('screen2'),
  s3: document.getElementById('screen3'),
  s4: document.getElementById('screen4'),
  s5: document.getElementById('screen5'),
  sl: document.getElementById('screenLang')
};
const fromInp = document.getElementById('fromInput');
const toInp = document.getElementById('toInput');
const proposalMusic = document.getElementById('proposalMusic');
const celebrationMusic = document.getElementById('celebrationMusic');
const musicToggleBtn = document.getElementById('musicToggle');
let musicOn = false;
let currentFrom = '';
let currentTo = '';

/* Play / Pause music controlled by user */
function toggleMusic(){
  musicOn = !musicOn;
  if(musicOn){
    proposalMusic.play().catch(()=>{});
    musicToggleBtn.textContent = 'ğŸ”Š Music: On';
  } else {
    proposalMusic.pause();
    musicToggleBtn.textContent = 'ğŸ”ˆ Music: Off';
  }
}

/* Pre-fill sample */
function fillExample(){
  fromInp.value = 'Ivan';
  toInp.value = 'Riya';
}

/* show screen helper */
function showScreen(id){
  Object.values(screens).forEach(el=>el.classList.remove('active'));
  if(id==='screen1') screens.s1.classList.add('active');
  if(id==='screen2') screens.s2.classList.add('active');
  if(id==='screen3') screens.s3.classList.add('active');
  if(id==='screen4') screens.s4.classList.add('active');
  if(id==='screen5') screens.s5.classList.add('active');
  if(id==='screenLang') screens.sl.classList.add('active');
}

/* floating effects */
function spawnFloating(type){
  const el = document.createElement('div');
  el.className = type;
  if(type==='heart') el.innerHTML='ğŸ’•';
  if(type==='star') el.innerHTML='âœ¦';
  if(type==='petal') el.innerHTML='ğŸŒ¸';
  const left = Math.random()*window.innerWidth;
  el.style.left = left + 'px';
  const size = (type==='star'? (8+Math.random()*12) : (16+Math.random()*26));
  el.style.fontSize = size + 'px';
  const dur = (type==='petal' ? (5+Math.random()*6) : (7+Math.random()*6));
  el.style.animationDuration = dur + 's';
  document.body.appendChild(el);
  setTimeout(()=> el.remove(), (dur*1000)+200);
}
setInterval(()=>spawnFloating('heart'), 450);
setInterval(()=>spawnFloating('star'), 700);
setInterval(()=>spawnFloating('petal'), 650);

/* click heart trail */
document.addEventListener('click', (ev)=>{
  if(ev.target.tagName.toLowerCase() === 'button' || ev.target.tagName.toLowerCase() === 'input') return;
  const h = document.createElement('div');
  h.className = 'clickHeart';
  h.innerHTML = 'ğŸ’—';
  h.style.left = ev.clientX + 'px';
  h.style.top = ev.clientY + 'px';
  document.body.appendChild(h);
  setTimeout(()=> h.remove(), 1000);
});

/* typewriter */
function typeWriter(text, el, speed=36, callback){
  el.innerHTML = '';
  let i=0;
  function step(){
    if(i<text.length){
      el.innerHTML += text.charAt(i);
      i++;
      setTimeout(step, speed);
    }else if(callback) callback();
  }
  step();
}

/* shareable url */
function setShareableURL(from, to){
  const base = location.origin + location.pathname;
  const params = new URLSearchParams({from, to});
  const url = `${base}?${params.toString()}`;
  history.replaceState(null, '', url);
  return url;
}
async function copyText(str){
  try{
    await navigator.clipboard.writeText(str);
    alert('Link copied to clipboard!');
  }catch(e){
    const ta = document.createElement('textarea');
    ta.value = str; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy'); ta.remove();
    alert('Link copied to clipboard!');
  }
}

/* Main flow */
function generateProposal(){
  const from = (fromInp.value || '').trim();
  const to = (toInp.value || '').trim();
  if(!from || !to){ alert('Please enter both names.'); return; }
  currentFrom = from; currentTo = to;
  setShareableURL(currentFrom, currentTo);

  // Start music as user gesture
  musicOn = true;
  proposalMusic.play().catch(()=>{});
  musicToggleBtn.textContent = 'ğŸ”Š Music: On';

  showScreen('screen2');
  const t1 = document.getElementById('type1');
  const msg1 = `Hello ${escapeHtml(currentTo)} â¤ï¸\nğŠğ²ğš ğ€ğšğ© ğ˜ğ¡ğš ğ‚ğ¥ğ¢ğœğ¤ ğŠğ«ğ¨ğ ğ¢ ğŒğğ«ğ ğ‹ğ¢ğ²ğ ğğ¥ğ¬ ğŸ’•`;
  typeWriter(msg1, t1, 36);
}

function goToStep2(){
  showScreen('screen3');
  const t2 = document.getElementById('type2');
  const msg2 = `${escapeHtml(currentFrom)} ğ€ğšğ©ğ¬ğ ğğ¨ğ¥ğ§ğš ğ‚ğ¡ğšğ¡ğ­ğš ğ‡ğšğ¢... ğŸ’ğŸ’•\nğŠğ²ğš ğŒğšğ¢ ğ€ğšğ© ğ’ğ ğğ¨ğ¥ğğ®?`;
  typeWriter(msg2, t2, 36);
}

function goBack(step){
  if(step===1) { showScreen('screen1'); history.replaceState(null,'',location.pathname); }
  if(step===2) { showScreen('screen2'); }
}

/* YES click */
function yesClick(){
  const yesBtn = document.getElementById('yesBtn');
  const rect = yesBtn.getBoundingClientRect();
  for(let i=0;i<14;i++){
    const b = document.createElement('div');
    b.className='burstHeart';
    b.innerHTML = ['ğŸ’','ğŸ’—','ğŸ’•'][Math.floor(Math.random()*3)];
    const x = rect.left + rect.width/2 + (Math.random()*240 - 120);
    const y = rect.top + rect.height/2 + (Math.random()*120 - 60);
    b.style.left = x + 'px';
    b.style.top = y + 'px';
    b.style.color = `hsl(${Math.random()*50 + 300},80%,70%)`;
    document.body.appendChild(b);
    setTimeout(()=> b.remove(), 1200);
  }

  showScreen('screen4');
  const counter = document.getElementById('loveCounter');
  let v=0; const target=143;
  const step = Math.max(1, Math.floor(target/60));
  const timer = setInterval(()=>{
    v += step;
    if(v>=target){ v=target; clearInterval(timer); }
    counter.textContent = v + ' â¤ï¸';
  }, 22);

  updateWhatsAppButton();
}

/* Celebration screen (Option B) */
function showCelebrate(){
  try { proposalMusic.pause(); } catch(e){}
  celebrationMusic.currentTime = 0;
  celebrationMusic.play().catch(()=>{});

  showScreen('screen5');
  spawnConfettiSoft(28);
  for(let i=0;i<10;i++){ setTimeout(()=> spawnFloatingBurstyHeart(), i*220); }
}

/* confetti and hearts */
function spawnConfettiSoft(n){
  for(let i=0;i<n;i++){
    const c=document.createElement('div');
    c.className='confettiPiece';
    c.style.left = (Math.random()*100) + 'vw';
    c.style.background = ['#ffb6d9','#ff77aa','#ffd6ef','#fff0f8'][Math.floor(Math.random()*4)];
    c.style.width = (6+Math.random()*10)+'px';
    c.style.height = (8+Math.random()*14)+'px';
    c.style.top = (-10 - Math.random()*30)+'vh';
    c.style.animationDuration = (4+Math.random()*4)+'s';
    document.body.appendChild(c);
    setTimeout(()=> c.remove(), 9000);
  }
}
function spawnFloatingBurstyHeart(){
  const h = document.createElement('div');
  h.className='heart';
  h.innerHTML='ğŸ’–';
  h.style.left = (30 + Math.random()*40) + 'vw';
  h.style.fontSize = (28 + Math.random()*36) + 'px';
  h.style.animationDuration = (6 + Math.random()*6) + 's';
  document.body.appendChild(h);
  setTimeout(()=> h.remove(), 9000);
}

/* WhatsApp share & copy link */
function getCurrentProposalURL(){
  const base = location.origin + location.pathname;
  const params = new URLSearchParams({from: currentFrom, to: currentTo});
  return `${base}?${params.toString()}`;
}
function updateWhatsAppButton(){
  const btn = document.getElementById('waShareBtn');
  if(!btn) return;
  btn.onclick = ()=> shareWhatsApp();
}
function shareWhatsApp(isCelebration=false){
  const url = getCurrentProposalURL();
  let text;
  if(isCelebration){
    text = `She said YES! ğŸ’ğŸ’– ${currentFrom} & ${currentTo} â€” Celebrate with us: ${url}`;
  } else {
    text = `Hi ${currentTo}! ${currentFrom} has a special proposal for you ğŸ’– Open here: ${url}`;
  }
  const encoded = encodeURIComponent(text);
  const waUrl = `https://wa.me/?text=${encoded}`;
  window.open(waUrl, '_blank');
}
function copyProposalLink(){
  const url = getCurrentProposalURL();
  copyText(url);
}
function copyCurrentURL(){
  copyText(location.href);
}

/* reset and helpers */
function resetAll(){
  try{ celebrationMusic.pause(); }catch(e){}
  try{ proposalMusic.pause(); }catch(e){}
  history.replaceState(null,'',location.pathname);
  currentFrom = ''; currentTo = '';
  fromInp.value=''; toInp.value='';
  showScreen('screen1');
  musicOn = false; musicToggleBtn.textContent = 'ğŸ”ˆ Music: Off';
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
}
function downloadScreenshot(){
  alert('To save a screenshot, use your device screenshot feature (mobile: power+volume, desktop: PrintScreen).');
}

/* Auto-fill from URL on load */
(function checkURLParams(){
  const p = new URLSearchParams(location.search);
  const f = p.get('from');
  const t = p.get('to');
  if(f) fromInp.value = f;
  if(t) toInp.value = t;
  if(f && t){
    currentFrom = f; currentTo = t;
    setShareableURL(currentFrom, currentTo);
    // auto-generate after small delay to ensure user sees page (we treat as user gesture)
    setTimeout(()=> generateProposal(), 300);
  }
})();

</script>

</body>
</html>