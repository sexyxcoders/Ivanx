<!doctype html>
<html lang="en">    
<head>    
<meta charset="utf-8" />    
<meta name="viewport" content="width=device-width,initial-scale=1" />    
<title>üíç Romantic Proposal ‚Äî Light Pink Love Flow</title>    
<style>    
:root{    
  --soft-pink: #ffc4e1; /* Lighter/Softer for text */
  --accent-pink: #ff5eaa; /* Primary button color */
  --rich-pink: #ff85c2; /* Glass border/glow color */
  --deep-burgundy: #1a0010; /* Deeper base */
  --text-light: #fffcfd; /* Almost white for titles */
}    
*{box-sizing:border-box}    
html,body{height:100%}    
body{    
  margin:0;    
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;    
  /* Richer Background: Dark pinks fading to light */
  background: linear-gradient(135deg, var(--deep-burgundy) 0%, #30001f 40%, #fff0f6 100%);    
  color:var(--text-light);    
  overflow-x:hidden;    
  -webkit-font-smoothing:antialiased;    
  text-align:center;    
}
/* outer glow border - More diffuse and romantic, slightly thicker */  
body::before{  
content:"";  
position:fixed;  
inset:3px;
border-radius:22px;
box-shadow: 0 0 160px rgba(255,100,170,0.7); /* Stronger, softer glow */
pointer-events:none;  
}  
/* container - Enhanced Glassmorphism Effect for better clarity */
.container{
width:94%;
max-width:900px;
margin:40px auto;
padding:30px 24px;
border-radius:25px;
background: rgba(255, 182, 217, 0.04); /* Reduced opacity for clarity */
border: 1px solid rgba(255, 255, 255, 0.1); 
backdrop-filter: blur(25px) saturate(200%); /* Increased blur */
box-shadow: 0 40px 90px rgba(0,0,0,0.6); /* Deeper shadow */
}

/* headings */
.title{
font-size:32px; 
color:var(--text-light);
margin-bottom:6px;
text-shadow: 0 12px 40px rgba(255,80,150,0.6); 
font-weight: 900;
letter-spacing: 1px;
}
.subtitle{
color:#ffe7f3;
margin-bottom:24px;
font-size: 15px;
}

/* screens */
.screen{ display:none; padding:10px; }
.screen.active{ display:block; animation: screenIn 600ms ease; }
@keyframes screenIn{ from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:none} }

/* typewriter */
.typewriter{
font-size:28px; 
font-weight:700;
color:var(--soft-pink);
display:inline-block;
white-space:pre-wrap;
border-right: 4px solid var(--rich-pink); 
padding-right:8px;
margin-bottom:20px;
text-shadow: 0 0 14px rgba(255,182,217,1); /* Very strong glow */
}

/* inputs & buttons */
.row{ display:flex; gap:14px; justify-content:center; flex-wrap:wrap; align-items:center; }
input[type="text"]{
width:260px;
padding:14px 18px;
border-radius:14px;
border:2px solid rgba(255,120,170,0.5);
background: rgba(255,255,255,0.15); /* Slightly clearer background */
color:var(--text-light);
font-size:17px;
transition: border-color .3s, box-shadow .3s;
font-weight: 500;
}
input[type="text"]:focus {
  border-color: var(--accent-pink);
  outline: none;
  box-shadow: 0 0 15px var(--accent-pink);
}
.btn{
appearance:none;
border:0;
padding:14px 24px;
border-radius:16px;
font-size:17px;
cursor:pointer;
color:var(--text-light);
background: linear-gradient(180deg, var(--rich-pink), var(--accent-pink));
box-shadow: 0 10px 35px rgba(255,80,150,0.5), inset 0 3px 5px rgba(255,255,255,0.4);
transition: transform .2s ease, box-shadow .2s ease;
font-weight: 600;
letter-spacing: 0.5px;
}
.btn:active{ 
  transform: translateY(1px); /* Smoother press */
  box-shadow: 0 5px 15px rgba(255,60,140,0.4), inset 0 1px 2px rgba(0,0,0,0.3);
}
.btn:hover{ 
  transform: translateY(-2px) rotateX(5deg); /* Subtle 3D tilt on hover */
  box-shadow: 0 20px 50px rgba(255,60,140,0.6), inset 0 3px 5px rgba(255,255,255,0.4);
}

/* Specific Proposal Buttons */
.btn-yes {
  background: linear-gradient(180deg, #b3f0ff, #00b3e6);
  box-shadow: 0 20px 60px rgba(0, 179, 230, 0.7), inset 0 3px 5px rgba(255,255,255,0.5);
  font-size: 24px; 
  padding: 18px 40px;
  font-weight: 900;
}
.btn-yes:hover {
  transform: translateY(-4px) rotateX(5deg); 
  box-shadow: 0 30px 80px rgba(0, 179, 230, 0.9), inset 0 3px 5px rgba(255,255,255,0.5);
}
.btn-no {
    opacity: 0.9;
    background: linear-gradient(180deg, #5e003d, #42002b);
    box-shadow: none;
    padding: 12px 20px;
    font-size: 15px;
}
.btn-no:hover {
    transform: none;
    box-shadow: 0 0 12px rgba(255,255,255,0.15);
}

/* 40-language list */
.langGrid{
display:grid;
grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
gap:12px;
margin-top:25px;
text-align:left;
max-width:920px;
margin-left:auto;
margin-right:auto;
color:#ffe7f3;
font-size:16px;
padding:15px;
background: rgba(255,255,255,0.06); /* Lighter/more transparent background */
border-radius:15px;
}
.langGrid > div {
  padding: 4px 0;
  opacity: 0;
  animation: languageIn 400ms ease-out forwards;
}
@keyframes languageIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: none; }
}

/* poem box */
.poemBox{
max-width:820px;
margin:30px auto 20px;
padding:25px 30px;
border-radius:18px; 
background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,120,170,0.15));
border:1px solid rgba(255,120,170,0.3);
color:#ffdfe9;
font-style:italic;
font-size:20px;
box-shadow: 0 18px 45px rgba(255,60,140,0.3);
display:none;
white-space: pre-wrap;
text-align: center;
line-height: 1.6;
}
.poemBox.show {
    display: block;
    animation: poemFadeIn 800ms ease forwards;
}
@keyframes poemFadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

/* celebrate screen */
.celebrate .big{
font-size:64px; 
color:var(--text-light);
text-shadow: 0 20px 60px rgba(255,80,160,0.6);
}
.celebrate .sub{
color:#ffdfe9;
margin-bottom:25px;
font-size: 22px;
}

/* -------- NEW/IMPROVED EFFECTS STYLES -------- */
/* Floating Hearts */
.heart, .petal, .star {
    position: fixed;
    top: 100vh; /* Start off-screen bottom */
    z-index: 10;
    opacity: 0; /* Managed by JS/animation */
    pointer-events: none;
    color: var(--soft-pink); /* Ensure emojis have color/shadow */
    filter: drop-shadow(0 0 6px rgba(255,182,217,0.5));
}
/* New Smooth Animation for Hearts & Petals */
@keyframes floatUpSmooth { 
    0%   { transform: translate(0, 0) scale(0.8) rotate(0deg); opacity: 0; }
    5%   { opacity: 1; }
    50%  { transform: translate(var(--dx), -50vh) scale(1.1) rotate(var(--rot1)); opacity: 1; }
    100% { transform: translate(var(--dx2), -110vh) scale(1.5) rotate(var(--rot2)); opacity: 0; }
}

/* Confetti */
.confettiPiece {
    position: fixed;
    border-radius: 50%;
    opacity: 0.95;
    z-index: 40;
    animation: fall ease-in infinite;
}
/* Confetti Fall (added rotation) */
@keyframes fall {
    0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0.8; }
}
</style>

</head>    
<body>  <div class="container">    
  <div class="title">üíñ Romantic Proposal Maker</div>    
  <div class="subtitle">Personalized Link ‚Ä¢ 40 Languages ‚Ä¢ Poem ‚Ä¢ Music & Celebration</div>    

  <div id="s1" class="screen active">    
    <div class="typewriter">Enter names to generate your special proposal.</div>    
    <div class="row" style="margin-top:12px">    
      <input id="fromInput" placeholder="Your name (e.g. Ivan)" type="text" />    
      <input id="toInput" placeholder="Partner name (e.g. Riya)" type="text" />    
    </div>  
    <div class="row" style="margin-top:16px">    
      <button class="btn" onclick="generateProposal()">Generate Proposal & Play Music</button>    
      <button class="btn" onclick="fillExample()">Try Example</button>    
    </div>    
    <div style="margin-top:16px" class="row">
        <button class="btn" onclick="copyCurrentURL()">üîó Copy Page Link</button>
    </div>
    <div style="margin-top:14px; color:#ffdfe9; font-size:14px">Tip: Share the generated link on WhatsApp using the Share button later.</div>    
  </div>    

  <div id="s2" class="screen">    
    <div id="msgTop" class="typewriter"></div>  
    <div style="margin-top:12px; margin-bottom: 20px;" class="row">    
      <button class="btn" onclick="showProposalScreen()">**ùêè·¥Ä·¥ã·¥ã·¥Ä ùêç·¥Ä·¥Ä?** [Click Here to Ask]</button>    
    </div>
    <div class="langGrid" id="langGrid"></div>    
    <div style="margin-top:25px" class="row">    
      <button class="btn" onclick="togglePoem()">Read a Special Love Poem üíó</button>    
      <button class="btn" onclick="shareWhatsApp()">Share Proposal Link</button>    
      <button class="btn" onclick="goBackHome()">‚üµ Start Over</button>    
    </div>    
    <div id="poemBox" class="poemBox" aria-hidden="true"></div>    
  </div>    

  <div id="s2a" class="screen">
      <div id="proposalMsg" class="typewriter" style="font-size: 38px; font-weight: 800; color: var(--rich-pink); margin-bottom: 60px;"></div> 
      <div class="row">
          <button class="btn btn-yes" onclick="showCelebrate()">YES! A lifetime of happiness üíç</button>
      </div>
      <div class="row" style="margin-top: 15px;">
          <button class="btn btn-no" onclick="goBackHome()">Can I think about it? (Go Back)</button>
      </div>
  </div>


  <div id="s3" class="screen celebrate">    
    <div class="big">She Said YES üíçüíñ</div>    
    <div class="sub">A new chapter begins ‚Äî love, laughter & forever.</div>  
    <div style="margin-top:16px" class="row">    
        <button class="btn" onclick="shareWhatsApp(true)">üì≤ Share This Celebration</button>    
        <button class="btn" onclick="downloadScreenshot()">üíæ Save Screenshot</button>    
        <button class="btn" onclick="resetAll()">üîÅ Start New</button>    
    </div>    
  </div>  
</div> 
<audio id="proposalMusic" loop preload="auto">    
  <source src="https://files.catbox.moe/0p8z4m.mp3" type="audio/mpeg">    
</audio>  
<audio id="celebrationMusic" loop preload="auto">    
  <source src="https://files.catbox.moe/1j3k9p.mp3" type="audio/mpeg">    
</audio>  
<div id="fxRoot"></div>  
<script>    
/* --------------------- Globals --------------------- */    
const screens = {    
  s1: document.getElementById('s1'),    
  s2: document.getElementById('s2'),    
  s2a: document.getElementById('s2a'), 
  s3: document.getElementById('s3')    
};    
const fromInput = document.getElementById('fromInput');    
const toInput   = document.getElementById('toInput');    
const langGrid  = document.getElementById('langGrid');    
const msgTop    = document.getElementById('msgTop');    
const poemBox   = document.getElementById('poemBox');    
const proposalMsg = document.getElementById('proposalMsg'); 
const proposalMusic = document.getElementById('proposalMusic');    
const celebrationMusic = document.getElementById('celebrationMusic');    
const fxRoot = document.getElementById('fxRoot');    
let musicEnabled = false;
let currentFrom = '';
let currentTo = '';
let poemVisible = false;

/* 40 "I love you" translations */
const iLoveYou = [
{lang:'English', text:'I love you'},
{lang:'Hindi', text:'‡§Æ‡•à‡§Ç ‡§§‡•Å‡§Æ‡§∏‡•á ‡§™‡•ç‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§§‡§æ/‡§ï‡§∞‡§§‡•Ä ‡§π‡•Ç‡§Å'},
{lang:'Urdu', text:'ŸÖ€å⁄∫ ÿ™ŸÖ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ÿ™ÿß/⁄©ÿ±ÿ™€å €ÅŸà⁄∫'},
{lang:'Bengali', text:'‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶ø'},
{lang:'Gujarati', text:'‡™π‡´Å‡™Ç ‡™§‡™®‡´á ‡™™‡´ç‡™∞‡´á‡™Æ ‡™ï‡™∞‡´Å‡™Ç ‡™õ‡´Å‡™Ç'},
{lang:'Marathi', text:'‡§Æ‡•Ä ‡§§‡•Å‡§ù‡•ç‡§Ø‡§æ‡§µ‡§∞ ‡™™‡´ç‡™∞‡´á‡™Æ ‡§ï‡§∞‡§§‡•ã/‡™ï‡™∞‡™§‡´á'},
{lang:'Tamil', text:'‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æ©‡Øç‡Æ©‡Øà ‡Æï‡Ææ‡Æ§‡Æ≤‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç'},
{lang:'Telugu', text:'‡∞®‡±á‡∞®‡±Å ‡∞®‡∞ø‡∞®‡±ç‡∞®‡±Å ‡∞™‡±ç‡∞∞‡±á‡∞Æ‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å'},
{lang:'Kannada', text:'‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤®‡≥ç‡≤®‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≥Ä‡≤§‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤®‡≥Ü'},
{lang:'Malayalam', text:'‡¥û‡¥æ‡µª ‡¥®‡¥ø‡¥®‡µç‡¥®‡µÜ ‡¥∏‡µç‡¥®‡µá‡¥π‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ'},
{lang:'Punjabi', text:'‡®Æ‡©à‡®Ç ‡®§‡©à‡®®‡©Ç‡©∞ ‡®™‡®ø‡®Ü‡®∞ ‡®ï‡®∞‡®¶‡®æ/‡®ï‡®∞‡®¶‡©Ä ‡®π‡®æ‡®Ç'},
{lang:'Nepali', text:'‡§Æ ‡§§‡§ø‡§Æ‡•Ä‡§≤‡§æ‡§à ‡§Æ‡§æ‡§Ø‡§æ ‡§ó‡§∞‡•ç‡§õ‡•Å'},
{lang:'Sinhala', text:'‡∂∏‡∂∏ ‡∂î‡∂∫‡∑è‡∂ß ‡∂Ü‡∂Ø‡∂ª‡∑ô‡∂∫‡∑í'},
{lang:'Arabic', text:'ÿ£ÿ≠ÿ®ŸÉ'},
{lang:'Turkish', text:'Seni seviyorum'},
{lang:'French', text:'Je t\'aime'},
{lang:'Spanish', text:'Te amo'},
{lang:'German', text:'Ich liebe dich'},
{lang:'Italian', text:'Ti amo'},
{lang:'Tagalog', text:'Mahal kita'},
{lang:'Indonesian', text:'Aku cinta kamu'},
{lang:'Thai', text:'‡∏â‡∏±‡∏ô‡∏£‡∏±‡∏Å‡∏Ñ‡∏∏‡∏ì'},
{lang:'Burmese', text:'·ÄÑ·Ä´·Äû·ÄÑ·Ä∑·Ä∫·ÄÄ·Ä≠·ÄØ·ÄÅ·Äª·ÄÖ·Ä∫·Äê·Äö·Ä∫'},
{lang:'Korean', text:'ÏÇ¨ÎûëÌï¥Ïöî'},
{lang:'Japanese', text:'ÊÑõ„Åó„Å¶„Çã'},
{lang:'Chinese', text:'ÊàëÁà±‰Ω†'},
{lang:'Russian', text:'–Ø —Ç–µ–±—è –ª—é–±–ª—é'},
{lang:'Portuguese', text:'Eu te amo'},
{lang:'Vietnamese', text:'Anh y√™u em / Em y√™u anh'},
{lang:'Farsi', text:'ÿØŸàÿ≥ÿ™ÿ™ ÿØÿßÿ±ŸÖ'},
{lang:'Hebrew', text:'◊ê◊†◊ô ◊ê◊ï◊î◊ë/◊™ ◊ê◊ï◊™◊ö'},
{lang:'Swahili', text:'Nakupenda'},
{lang:'Polish', text:'Kocham ciƒô'},
{lang:'Dutch', text:'Ik hou van jou'},
{lang:'Greek', text:'Œ£\'Œ±Œ≥Œ±œÄœé'},
{lang:'Romanian', text:'Te iubesc'},
{lang:'Czech', text:'Miluji tƒõ'},
{lang:'Hungarian', text:'Szeretlek'},
{lang:'Malay', text:'Saya cinta padamu'},
{lang:'Bulgarian', text:'–û–±–∏—á–∞–º —Ç–µ'}
];

/* poem text (requested) */
const poemText = `Tum chhodo bhii kuchh kehne ko..
Mein kehta huu mujhe kehne do..
Ek-tarfa ishq hii behtar hai..
Mai krta huu tum rehne do..`;

/* Proposal Message */
const proposalText = (to, from) => `
**ùüèùüíùüë ‚ù§Ô∏è**
My Dearest ${to}, from the moment I met you, my world turned into the softest shade of pink, filled with a love that flows endlessly, just like those little hearts. You are my light, my laughter, and my forever. Every day with you is a gift I want to keep opening.

**Will you marry me, ${to}, and make ${from} the happiest person in this universe?**
`;

/* --------------------- Helpers --------------------- */
function showScreen(id){
Object.values(screens).forEach(s=>s.classList.remove('active'));
screens[id].classList.add('active');
if(id === 's2' || id === 's2a') smallBurst();
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* copy helper */
async function copyText(t){
try{ await navigator.clipboard.writeText(t); alert('Link copied to clipboard!'); }
catch(e){ const ta = document.createElement('textarea'); ta.value = t; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('Link copied to clipboard!'); }
}

/* small visual burst (mix soft + intense) */
function smallBurst(){
const cx = window.innerWidth/2;
const cy = window.innerHeight*0.4;
for(let i=0;i<10;i++){
const b = document.createElement('div');
b.className = 'burst';
b.innerHTML = ['üíû','üíó','üíï'][Math.floor(Math.random()*3)];
b.style.left = (cx + (Math.random()*300-150))+'px';
b.style.top  = (cy + (Math.random()*80-40))+'px';
b.style.color = `hsl(${330 + Math.random()*40},80%,70%)`;
b.style.fontSize = (18 + Math.random()*18)+'px';
document.body.appendChild(b);
setTimeout(()=>b.remove(),900);
}
for(let i=0;i<14;i++){
setTimeout(()=> spawnFloating('star'), i*80);
}
}

/* spawn floating elements - IMPROVED FLOWING EFFECT */
function spawnFloating(type){
const el = document.createElement('div');
el.className = type;
// Use emojis for transparent effect
if(type==='heart') el.innerHTML = ['üíï','üíó','üíû'][Math.floor(Math.random()*3)];
if(type==='star') el.innerHTML = '‚ú¶';
if(type==='petal') el.innerHTML = 'üå∏';

// Randomize start position
el.style.left = Math.random()*window.innerWidth + 'px';
// Randomize animation variables for smoother, non-repeating flow
const dur = (type==='petal' ? (6+Math.random()*4) : (8+Math.random()*6)); // Longer duration
const horizontalDrift = (Math.random() * 40 - 20) + 'vw'; // Drift up to 20vw left/right
const finalDrift = (Math.random() * 40 - 20) + 'vw';
const rot1 = (Math.random() * 30 - 15) + 'deg';
const rot2 = (Math.random() * 60 - 30) + 'deg';

el.style.setProperty('--dx', horizontalDrift);
el.style.setProperty('--dx2', finalDrift);
el.style.setProperty('--rot1', rot1);
el.style.setProperty('--rot2', rot2);

if(type==='petal') el.style.fontSize = (18 + Math.random()*26) + 'px';
else if(type==='heart') el.style.fontSize = (20 + Math.random()*30) + 'px';
else el.style.fontSize = (10 + Math.random()*16) + 'px';

el.style.animationName = 'floatUpSmooth'; // Use the new smooth animation
el.style.animationDuration = dur+'s';
el.style.animationDelay = (-Math.random() * dur) + 's'; // Start some mid-flow

document.body.appendChild(el);
setTimeout(()=>el.remove(), (dur*1000)+500);
}

/* continuous spawns (faster for more flow) */
setInterval(()=>spawnFloating('heart'), 300); // More hearts
setInterval(()=>spawnFloating('petal'), 600);
setInterval(()=>spawnFloating('star'), 800);

/* --------------------- Build language grid - SLOW REVEAL --------------------- */
function slowRevealLanguageGrid(){
    langGrid.innerHTML = '';
    const delayBetweenItems = 120; 

    iLoveYou.forEach((it, idx) => {
        const node = document.createElement('div');
        node.innerHTML = `<strong>${idx+1}. ${escapeHtml(it.lang)}:</strong> ${escapeHtml(it.text)}`;

        setTimeout(() => {
            langGrid.appendChild(node);
            node.style.animationDelay = '0s'; 
        }, idx * delayBetweenItems);
    });
}

/* --------------------- Shareable link & URL handling --------------------- */
function setShareableURL(from, to){
const base = location.origin + location.pathname;
const params = new URLSearchParams({from, to});
const url = `${base}?${params.toString()}`;
history.replaceState(null, '', url);
return url;
}
function getProposalURL(){ return setShareableURL(currentFrom, currentTo); }
function copyCurrentURL(){ copyText(location.href); }

/* --------------------- Music control (Autostart on first interaction) --------------------- */
function startMusic(){
  if (!musicEnabled) {
    musicEnabled = true;
    proposalMusic.currentTime = 0;
    proposalMusic.play().then(() => {
      // Success
    }).catch(e => {
      console.warn("Music play blocked:", e.name);
      musicEnabled = false;
    });
  }
}

/* --------------------- Flow functions --------------------- */
function fillExample(){ fromInput.value='Ivan'; toInput.value='Riya'; }

function generateProposal(){
const f = (fromInput.value || '').trim();
const t = (toInput.value || '').trim();
if(!f || !t){ alert('Please enter both names.'); return; }
currentFrom = f; currentTo = t;
setShareableURL(currentFrom, currentTo);

startMusic();

showScreen('s2');
const topMsg = `ùêá·¥á ü ü·¥è, ùêä è·¥Ä ùêÄ·¥Ä·¥ò ùêò ú·¥Ä ùêÇ ü…™·¥Ñ·¥ã ùêä Ä·¥è…¢…™ ùêå·¥á Ä·¥á ùêã…™ è·¥á ùêè üs üíï`;
typeWriter(topMsg, msgTop, 75);

slowRevealLanguageGrid();
}

function showProposalScreen(){
    showScreen('s2a');
    try { proposalMusic.pause(); } catch(e){}

    const finalMsg = proposalText(currentTo, currentFrom);
    typeWriter(finalMsg, proposalMsg, 100);
}


function goBackHome(){
history.replaceState(null,'',location.pathname);
currentFrom=''; currentTo='';
try { proposalMusic.pause(); celebrationMusic.pause(); } catch(e){}
musicEnabled = false;
showScreen('s1');
}

/* Poem toggle with typewriter and dramatic glow */
function togglePoem(){
if(poemVisible){
  poemVisible = false;
  poemBox.classList.remove('show');
  poemBox.innerHTML = '';
} else {
  poemVisible = true;
  poemBox.innerHTML = ''; 
  poemBox.classList.add('show'); 
  smallBurst();
  typeWriter(poemText, poemBox, 90);
  try { proposalMusic.volume = 0.9; setTimeout(()=>proposalMusic.volume = 1.0, 1200); } catch(e){}
}
}

/* typewriter function plots text into element; supports \n */
function typeWriter(text, el, speed=36, cb){
el.innerHTML = '';
let i = 0;
function step(){
  if(i < text.length){
    const ch = text.charAt(i);
    el.innerHTML += (ch === '\n' ? '<br>' : escapeHtml(ch));
    i++;
    setTimeout(step, speed);
  } else {
    if(cb) cb();
  }
}
step();
}

/* --------------------- WhatsApp share --------------------- */
function shareWhatsApp(isCelebration = false){
const url = getProposalURL();
let message;
if(isCelebration){
message = `She said YES! üíçüíñ ${currentFrom} & ${currentTo} ‚Äî Celebrate with us: ${url}`;
} else {
message = `Hi ${currentTo}! ${currentFrom} has a special proposal for you üíñ Open here: ${url}`;
}
const link = 'https://wa.me/?text=' + encodeURIComponent(message);
window.open(link, '_blank');
}

/* --------------------- Celebration --------------------- */
function showCelebrate(){
try { proposalMusic.pause(); } catch(e){}

try { 
  celebrationMusic.currentTime = 0; 
  celebrationMusic.play().catch(e => {
    console.warn("Celebration Music play blocked (non-critical):", e.name);
  }); 
} catch(e){}

showScreen('s3');
spawnConfetti(100); // More confetti
for(let i=0;i<40;i++) setTimeout(()=>spawnFloating('heart'), i*80);
for(let i=0;i<30;i++){ setTimeout(()=>spawnBurstAtRandom(), i*60); }
}

function resetAll(){
  goBackHome();
  try { celebrationMusic.pause(); } catch(e){}
}

/* burst at random location */
function spawnBurstAtRandom(){
  const b = document.createElement('div');
  b.className = 'burst';
  b.innerHTML = ['üíñ','üíì','üíû'][Math.floor(Math.random()*3)];
  b.style.left = (Math.random()*window.innerWidth) + 'px';
  b.style.top  = (Math.random()*window.innerHeight*0.8) + 'px';
  b.style.color = `hsl(${320 + Math.random()*50},85%,70%)`;
  b.style.fontSize = (24 + Math.random()*38) + 'px';
  document.body.appendChild(b);
  setTimeout(()=> b.remove(), 1100);
}

/* confetti pieces */
function spawnConfetti(n){
for(let i=0;i<n;i++){
const c = document.createElement('div');
c.className = 'confettiPiece';
c.style.left = (Math.random()*100) + 'vw';
c.style.top = (-10 - Math.random()*20) + 'vh';
c.style.width = (8 + Math.random()*14) + 'px';
c.style.height = (8 + Math.random()*14) + 'px';
// Brighter confetti colors
c.style.background = ['#ff6f9f','#ff006e','#00b3e6','#ffffff'][Math.floor(Math.random()*4)];
c.style.animationDuration = (4 + Math.random()*5) + 's';
c.style.animationDelay = (Math.random()*3) + 's';
document.body.appendChild(c);
setTimeout(()=> c.remove(), 9000);
}
}

/* --------------------- screenshot helper (simple) --------------------- */
function downloadScreenshot(){
alert('Use your device screenshot (mobile: power+volume, desktop: PrintScreen) for best quality.');
}

/* --------------------- Auto-fill from URL on load --------------------- */
(function initFromURL(){
const p = new URLSearchParams(location.search);
const f = p.get('from'); const t = p.get('to');
if(f) fromInput.value = f;
if(t) toInput.value = t;
if(f && t){ setTimeout(()=> generateProposal(), 350); }
})();

</script>  </body>
</html>
