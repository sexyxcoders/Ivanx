<!doctype html>
<html lang="en">    
<head>    
<meta charset="utf-8" />    
<meta name="viewport" content="width=device-width,initial-scale=1" />    
<title>ğŸ’ Romantic Proposal â€” Light Pink Love Flow</title>    
<style>    
:root{    
  --soft-pink: #ffc4e1; /* Lighter/Softer for text */
  --accent-pink: #ff5eaa; /* Primary button color */
  --rich-pink: #ff85c2; /* Glass border/glow color */
  --deep-burgundy: #1a0010; /* Deeper base */
  --text-light: #fffcfd; /* Almost white for titles */
}    
*{box-sizing:border-box}    
html,body{height:100%}    
body{    
  margin:0;    
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;    
  /* Richer Background: Dark pinks fading to light */
  background: linear-gradient(135deg, var(--deep-burgundy) 0%, #30001f 40%, #fff0f6 100%);    
  color:var(--text-light);    
  overflow-x:hidden;    
  -webkit-font-smoothing:antialiased;    
  text-align:center;    
}
/* outer glow border - Softer glow */  
body::before{  
content:"";  
position:fixed;  
inset:5px; /* Slightly wider inset for drama */
border-radius:22px;
box-shadow: 0 0 120px rgba(255,100,170,0.5); /* Softer, less intense glow */
pointer-events:none;  
}  
/* container - Enhanced Glassmorphism Effect for maximum transparency and clarity */
.container{
width:94%;
max-width:900px;
margin:40px auto;
padding:30px 24px;
border-radius:25px;
background: rgba(255, 182, 217, 0.02); /* Very low opacity for maximum transparency */
border: 1px solid rgba(255, 255, 255, 0.08); /* Fainter border */
backdrop-filter: blur(30px) saturate(200%); /* Increased blur for frosted look */
box-shadow: 0 30px 80px rgba(0,0,0,0.4); /* Softer shadow */
}

/* headings */
.title{
font-size:32px; 
color:var(--text-light);
margin-bottom:6px;
text-shadow: 0 8px 30px rgba(255,80,150,0.4); /* Reduced glow intensity */
font-weight: 900;
letter-spacing: 1px;
}
.subtitle{
color:#ffe7f3;
margin-bottom:24px;
font-size: 15px;
}

/* screens */
.screen{ display:none; padding:10px; }
.screen.active{ 
  display:block; 
  animation: screenIn 1000ms ease; /* Slower screen transition */
}
@keyframes screenIn{ from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:none} }

/* typewriter */
.typewriter{
font-size:28px; 
font-weight:700;
color:var(--soft-pink);
display:inline-block;
white-space:pre-wrap;
border-right: 4px solid var(--rich-pink); 
padding-right:8px;
margin-bottom:20px;
text-shadow: 0 0 10px rgba(255,182,217,0.7); /* Softer glow */
}

/* inputs & buttons */
.row{ display:flex; gap:14px; justify-content:center; flex-wrap:wrap; align-items:center; }
input[type="text"]{
width:260px;
padding:14px 18px;
border-radius:14px;
border:2px solid rgba(255,120,170,0.4); /* Softer border */
background: rgba(255,255,255,0.08); /* More transparent input */
color:var(--text-light);
font-size:17px;
transition: border-color .3s, box-shadow .3s;
font-weight: 500;
}
input[type="text"]:focus {
  border-color: var(--accent-pink);
  outline: none;
  box-shadow: 0 0 12px var(--accent-pink);
}
.btn{
appearance:none;
border:0;
padding:14px 24px;
border-radius:16px;
font-size:17px;
cursor:pointer;
color:var(--text-light);
background: linear-gradient(180deg, var(--rich-pink), var(--accent-pink));
box-shadow: 0 8px 25px rgba(255,80,150,0.4), inset 0 3px 5px rgba(255,255,255,0.4); /* Softer shadow */
transition: transform .3s ease, box-shadow .3s ease; /* Slower hover transition */
font-weight: 600;
letter-spacing: 0.5px;
}
.btn:active{ 
  transform: translateY(1px); 
  box-shadow: 0 4px 10px rgba(255,60,140,0.3), inset 0 1px 2px rgba(0,0,0,0.3);
}
.btn:hover{ 
  transform: translateY(-2px) rotateX(2deg); /* Less aggressive 3D tilt */
  box-shadow: 0 15px 40px rgba(255,60,140,0.5), inset 0 3px 5px rgba(255,255,255,0.4);
}

/* Disabled button style */
.btn:disabled {
  cursor: not-allowed;
  opacity: 0.5;
  filter: grayscale(100%);
  transform: none !important;
  box-shadow: none !important;
}

/* Specific Proposal Buttons (also softened) */
.btn-yes {
  background: linear-gradient(180deg, #b3f0ff, #00b3e6);
  box-shadow: 0 15px 45px rgba(0, 179, 230, 0.5), inset 0 3px 5px rgba(255,255,255,0.5);
  font-size: 24px; 
  padding: 18px 40px;
  font-weight: 900;
}
.btn-yes:hover {
  transform: translateY(-3px) rotateX(2deg); 
  box-shadow: 0 25px 60px rgba(0, 179, 230, 0.7), inset 0 3px 5px rgba(255,255,255,0.5);
}
.btn-no {
    opacity: 0.7; /* More transparent */
    background: linear-gradient(180deg, #5e003d, #42002b);
    box-shadow: none;
    padding: 12px 20px;
    font-size: 15px;
}

/* 40-language list */
.langGrid{
display:grid;
grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
gap:12px;
margin-top:25px;
text-align:left;
max-width:920px;
margin-left:auto;
margin-right:auto;
color:#ffe7f3;
font-size:16px;
padding:15px;
background: rgba(255,255,255,0.04); /* Very transparent */
border-radius:15px;
}
.langGrid > div {
  padding: 4px 0;
  opacity: 0;
  animation: languageIn 800ms ease-out forwards; /* Slower reveal */
}
@keyframes languageIn {
    from { opacity: 0; transform: translateX(-15px); }
    to { opacity: 1; transform: none; }
}

/* poem box */
.poemBox{
max-width:820px;
margin:30px auto 20px;
padding:25px 30px;
border-radius:18px; 
background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,120,170,0.1)); /* Very transparent */
border:1px solid rgba(255,120,170,0.2);
color:#ffdfe9;
font-style:italic;
font-size:20px;
box-shadow: 0 15px 35px rgba(255,60,140,0.2);
display:none;
white-space: pre-wrap;
text-align: center;
line-height: 1.6;
}
.poemBox.show {
    display: block;
    animation: poemFadeIn 1200ms ease forwards; /* Slower fade in */
}
@keyframes poemFadeIn {
    from { opacity: 0; transform: scale(0.98); }
    to { opacity: 1; transform: scale(1); }
}


/* Floating Hearts - Smoother, Slower */
.heart, .petal, .star {
    position: fixed;
    top: 100vh; 
    z-index: 10;
    opacity: 0; 
    pointer-events: none;
    color: var(--soft-pink); 
    filter: drop-shadow(0 0 4px rgba(255,182,217,0.4)); /* Softer glow */
    animation-timing-function: linear !important; /* Constant speed */
}
/* New Smooth Animation for Hearts & Petals - MUCH LONGER DURATION */
@keyframes floatUpSmooth { 
    0%   { transform: translate(0, 0) scale(0.7) rotate(0deg); opacity: 0; }
    5%   { opacity: 0.9; } /* Stay mostly opaque during rise */
    50%  { transform: translate(var(--dx), -50vh) scale(1.0) rotate(var(--rot1)); opacity: 0.9; }
    100% { transform: translate(var(--dx2), -110vh) scale(1.2) rotate(var(--rot2)); opacity: 0; }
}

/* Confetti - Slower, Drifting Fall */
.confettiPiece {
    position: fixed;
    border-radius: 50%;
    opacity: 0.95;
    z-index: 40;
    animation: fall ease-in infinite;
}
/* Confetti Fall (added rotation) - LONGER DURATION */
@keyframes fall {
    0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
    5% { opacity: 0.9; }
    100% { transform: translateY(110vh) rotate(540deg); opacity: 0.6; } /* Slower rotation, more fade */
}
</style>

</head>    
<body>  <div class="container">    
  <div class="title">ğÊ€á´á´˜á´sá´€ÊŸ ğŒá´€á´‹á´‡Ê€</div>    
  <div class="subtitle">á´˜Ê€á´á´˜á´sá´€ÊŸ á´á´€á´‹á´‡Ê€ á´á´€á´…á´‡ Ê™Ê @noncarder</div>    

  <div id="s1" class="screen active">    
    <div class="typewriter">á´‡É´á´›á´‡Ê€ É´á´€á´á´‡'s á´›á´ É¢á´‡É´á´‡Ê€á´€á´›á´‡ Êá´á´œÊ€ sá´˜á´‡á´„Éªá´€ÊŸ á´˜Ê€á´á´˜á´sá´€ÊŸ Ò“á´Ê€ Êá´á´œÊ€ ÊŸá´á´ á´‡ÊŸÊ ğŸ˜Š á´˜á´‡Ê€sá´É´.</div>    
    <div class="row" style="margin-top:12px">    
      <input id="fromInput" placeholder="Your name (e.g. Ivan)" type="text" />    
      <input id="toInput" placeholder="Partner name (e.g. Abhika)" type="text" />    
    </div>  
    <div class="row" style="margin-top:16px">    
      <button class="btn" onclick="generateProposal()">ğ™²ğ™»ğ™¸ğ™²ğ™º ğ™·ğ™´ğšğ™´ ğšƒğ™¾ ğ™¶ğ™´ğ™½ğ™´ğšğ™°ğšƒğ™´</button>    
      <button class="btn" onclick="fillExample()">ğšƒğšğšˆ ğ™´ğš‡ğ™°ğ™¼ğ™¿ğ™»ğ™´</button>    
    </div>    
    <div style="margin-top:16px" class="row">
        <button class="btn" onclick="copyCurrentURL()">ğŸ”— ğ™²ğ™¾ğ™¿ğšˆ ğ™¿ğ™°ğ™¶ğ™´ ğ™»ğ™¸ğ™½ğ™º</button>
    </div>
    <div style="margin-top:14px; color:#ffdfe9; font-size:14px">Tip: Share the generated link on WhatsApp using the Share button later.</div>    
  </div>    

  <div id="s2" class="screen">    
    <div id="msgTop" class="typewriter"></div>  
    <div style="margin-top:12px; margin-bottom: 20px;" class="row">    
      <button id="askButton" class="btn" onclick="showProposalScreen()" disabled>ğá´‹Êœ.. [First, read my heart out below]</button>    
    </div>
    <div class="langGrid" id="langGrid"></div>    
    <div style="margin-top:25px" class="row">    
      <button class="btn" onclick="togglePoem()">ğšğ™´ğ™°ğ™³ ğ™¼ğšˆ ğ™·ğ™´ğ™°ğšğšƒ ğ™¾ğš„ğšƒ ğŸ“–</button>    
      <button class="btn" onclick="shareWhatsApp()">Sğ™·ğ™°ğšğ™´ ğ™¿ğšğ™¾ğ™¿ğ™¾ğš‚ğ™°ğ™» ğ™»ğ™¸ğ™½ğ™º</button>    
      <button class="btn" onclick="goBackHome()">âŸµ ğš‚ğšƒğ™°ğšğšƒ ğ™¾ğš…ğ™´ğš</button>    
    </div>    
    <div id="poemBox" class="poemBox" aria-hidden="true"></div>    
  </div>    

  <div id="s2a" class="screen">
      <div id="proposalMsg" class="typewriter" style="font-size: 38px; font-weight: 800; color: var(--rich-pink); margin-bottom: 60px;"></div> 
      <div class="row">
          <button class="btn btn-yes" onclick="showCelebrate()">Êá´‡s !! á´€ ÊŸÉªÒ“á´‡á´›Éªá´á´‡ á´Ò“ Êœá´€á´˜á´˜ÉªÉ´á´‡ss â¤</button>
      </div>
      <div class="row" style="margin-top: 15px;">
          <button class="btn btn-no" onclick="goBackHome()">Can I think about it? (Go Back)</button>
      </div>
  </div>


  <div id="s3" class="screen celebrate">    
    <div class="big">sÊœá´‡ sá´€Éªá´… Êá´‡s ğŸ’ğŸ’–</div>    
    <div class="sub">á´€ É´á´‡á´¡ á´„Êœá´€á´˜á´›á´‡Ê€ Ê™á´‡É¢ÉªÉ´s â€” ÊŸá´á´ á´‡, ÊŸá´€á´œÉ¢Êœá´›á´‡Ê€ & Ò“á´Ê€á´‡á´ á´‡Ê€.</div>  
    <div style="margin-top:16px" class="row">    
        <button class="btn" onclick="shareWhatsApp(true)">ğŸ“² sÊœá´€Ê€á´‡ á´›ÊœÉªs á´„á´‡ÊŸá´‡Ê™Ê€á´€á´›Éªá´É´</button>    
        <button class="btn" onclick="downloadScreenshot()">ğŸ’¾ sá´€á´ á´‡ Screenshot</button>    
        <button class="btn" onclick="resetAll()">ğŸ” Start New</button>    
    </div>    
  </div>  
</div> 
<audio id="proposalMusic" loop preload="auto">    
  <source src="https://files.catbox.moe/0p8z4m.mp3" type="audio/mpeg">    
</audio>  
<audio id="celebrationMusic" loop preload="auto">    
  <source src="https://files.catbox.moe/1j3k9p.mp3" type="audio/mpeg">    
</audio>  
<div id="fxRoot"></div>  
<script>    
/* --------------------- Globals --------------------- */    
const screens = {    
  s1: document.getElementById('s1'),    
  s2: document.getElementById('s2'),    
  s2a: document.getElementById('s2a'), 
  s3: document.getElementById('s3')    
};    
const fromInput = document.getElementById('fromInput');    
const toInput   = document.getElementById('toInput');    
const langGrid  = document.getElementById('langGrid');    
const msgTop    = document.getElementById('msgTop');    
const poemBox   = document.getElementById('poemBox');    
const proposalMsg = document.getElementById('proposalMsg'); 
const proposalMusic = document.getElementById('proposalMusic');    
const celebrationMusic = document.getElementById('celebrationMusic');    
const askButton = document.getElementById('askButton'); // New reference
const fxRoot = document.getElementById('fxRoot');    
let musicEnabled = false;
let currentFrom = '';
let currentTo = '';
let poemVisible = false;
let poemReadOnce = false; // New state variable

/* 40 "I love you" translations */
const iLoveYou = [
{lang:'English', text:'I love you'},
{lang:'Hindi', text:'à¤®à¥ˆà¤‚ à¤¤à¥à¤®à¤¸à¥‡ à¤ªà¥à¤¯à¤¾à¤° à¤•à¤°à¤¤à¤¾/à¤•à¤°à¤¤à¥€ à¤¹à¥‚à¤'},
{lang:'Urdu', text:'Ù…ÛŒÚº ØªÙ… Ø³Û’ Ù…Ø­Ø¨Øª Ú©Ø±ØªØ§/Ú©Ø±ØªÛŒ ÛÙˆÚº'},
{lang:'Bengali', text:'à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¿'},
{lang:'Gujarati', text:'àª¹à«àª‚ àª¤àª¨à«‡ àªªà«àª°à«‡àª® àª•àª°à«àª‚ àª›à«àª‚'},
{lang:'Marathi', text:'à¤®à¥€ à¤¤à¥à¤à¥à¤¯à¤¾à¤µà¤° àªªà«àª°à«‡àª® à¤•à¤°à¤¤à¥‹/àª•àª°àª¤à«‡'},
{lang:'Tamil', text:'à®¨à®¾à®©à¯ à®‰à®©à¯à®©à¯ˆ à®•à®¾à®¤à®²à®¿à®•à¯à®•à®¿à®±à¯‡à®©à¯'},
{lang:'Telugu', text:'à°¨à±‡à°¨à± à°¨à°¿à°¨à±à°¨à± à°ªà±à°°à±‡à°®à°¿à°¸à±à°¤à±à°¨à±à°¨à°¾à°¨à±'},
{lang:'Kannada', text:'à²¨à²¾à²¨à³ à²¨à²¿à²¨à³à²¨à²¨à³à²¨à³ à²ªà³à²°à³€à²¤à²¿à²¸à³à²¤à³à²¤à³‡à²¨à³†'},
{lang:'Malayalam', text:'à´à´¾àµ» à´¨à´¿à´¨àµà´¨àµ† à´¸àµà´¨àµ‡à´¹à´¿à´•àµà´•àµà´¨àµà´¨àµ'},
{lang:'Punjabi', text:'à¨®à©ˆà¨‚ à¨¤à©ˆà¨¨à©‚à©° à¨ªà¨¿à¨†à¨° à¨•à¨°à¨¦à¨¾/à¨•à¨°à¨¦à©€ à¨¹à¨¾à¨‚'},
{lang:'Nepali', text:'à¤® à¤¤à¤¿à¤®à¥€à¤²à¤¾à¤ˆ à¤®à¤¾à¤¯à¤¾ à¤—à¤°à¥à¤›à¥'},
{lang:'Sinhala', text:'à¶¸à¶¸ à¶”à¶ºà·à¶§ à¶†à¶¯à¶»à·™à¶ºà·’'},
{lang:'Arabic', text:'Ø£Ø­Ø¨Ùƒ'},
{lang:'Turkish', text:'Seni seviyorum'},
{lang:'French', text:'Je t\'aime'},
{lang:'Spanish', text:'Te amo'},
{lang:'German', text:'Ich liebe dich'},
{lang:'Italian', text:'Ti amo'},
{lang:'Tagalog', text:'Mahal kita'},
{lang:'Indonesian', text:'Aku cinta kamu'},
{lang:'Thai', text:'à¸‰à¸±à¸™à¸£à¸±à¸à¸„à¸¸à¸“'},
{lang:'Burmese', text:'á€„á€«á€á€„á€·á€ºá€€á€­á€¯á€á€»á€…á€ºá€á€šá€º'},
{lang:'Korean', text:'ì‚¬ë‘í•´ìš”'},
{lang:'Japanese', text:'æ„›ã—ã¦ã‚‹'},
{lang:'Chinese', text:'æˆ‘çˆ±ä½ '},
{lang:'Russian', text:'Ğ¯ Ñ‚ĞµĞ±Ñ Ğ»ÑĞ±Ğ»Ñ'},
{lang:'Portuguese', text:'Eu te amo'},
{lang:'Vietnamese', text:'Anh yÃªu em / Em yÃªu anh'},
{lang:'Farsi', text:'Ø¯ÙˆØ³ØªØª Ø¯Ø§Ø±Ù…'},
{lang:'Hebrew', text:'×× ×™ ××•×”×‘/×ª ××•×ª×š'},
{lang:'Swahili', text:'Nakupenda'},
{lang:'Polish', text:'Kocham ciÄ™'},
{lang:'Dutch', text:'Ik hou van jou'},
{lang:'Greek', text:'Î£\'Î±Î³Î±Ï€Ï'},
{lang:'Romanian', text:'Te iubesc'},
{lang:'Czech', text:'Miluji tÄ›'},
{lang:'Hungarian', text:'Szeretlek'},
{lang:'Malay', text:'Saya cinta padamu'},
{lang:'Bulgarian', text:'ĞĞ±Ğ¸Ñ‡Ğ°Ğ¼ Ñ‚Ğµ'}
];

/* poem text (requested) */
const poemText = `Tum chhodo bhii kuchh kehne ko..
Mein kehta huu mujhe kehne do..
Ek-tarfa ishq hii behtar hai..
Mai krta huu tum rehne do..`;

/* Proposal Message */
const proposalText = (to, from) => `
I Lá´á´ á´‡ Yá´á´œ! 
á´Ê á´…á´‡á´€Ê€á´‡sá´› ${to}, Ò“Ê€á´á´ á´›Êœá´‡ á´á´á´á´‡É´á´› Éª á´á´‡á´› Êá´á´œ, á´Ê á´¡á´Ê€ÊŸá´… á´›á´œÊ€É´á´‡á´… ÉªÉ´á´›á´ á´›Êœá´‡ sá´Ò“á´›á´‡sá´› shade á´Ò“ á´˜ÉªÉ´á´‹, Ò“ÉªÊŸÊŸá´‡á´… á´¡Éªá´›Êœ á´€ ÊŸá´á´ á´‡ á´›Êœá´€á´› Ò“ÊŸá´á´¡s á´‡É´á´…ÊŸá´‡ssÊŸÊ, á´Šá´œsá´› ÊŸÉªá´‹á´‡ á´›Êœá´sá´‡ ÊŸÉªá´›á´›ÊŸá´‡ Êœá´‡á´€Ê€á´›s. Êá´á´œ á´€Ê€á´‡ á´Ê ÊŸÉªÉ¢Êœá´›, á´Ê ÊŸá´€á´œÉ¢Êœá´›á´‡Ê€, á´€É´á´… á´Ê forever. á´‡á´ á´‡Ê€Ê á´…á´€Ê á´¡Éªá´›Êœ Êá´á´œ Éªs á´€ É¢ÉªÒ“á´› Éª á´¡á´€É´á´› á´›á´ á´‹á´‡á´‡á´˜ á´á´˜á´‡É´ÉªÉ´É¢.

WÉªÊŸÊŸ Yá´á´œ Má´€Ê€Ê€Ê Má´‡, ${to}, AÉ´á´… Má´€á´‹á´‡ ${from} TÊœá´‡ Há´€á´˜á´˜Éªá´‡sá´› Pá´‡Ê€sá´É´ IÉ´ TÊœÉªs UÉ´Éªá´ á´‡Ê€sá´‡?
`;

/* --------------------- Helpers --------------------- */
function showScreen(id){
Object.values(screens).forEach(s=>s.classList.remove('active'));
screens[id].classList.add('active');
if(id === 's2' || id === 's2a') smallBurst();
}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* copy helper */
async function copyText(t){
try{ await navigator.clipboard.writeText(t); alert('Link copied to clipboard!'); }
catch(e){ const ta = document.createElement('textarea'); ta.value = t; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('Link copied to clipboard!'); }
}

/* small visual burst (mix soft + intense) */
function smallBurst(){
const cx = window.innerWidth/2;
const cy = window.innerHeight*0.4;
for(let i=0;i<10;i++){
const b = document.createElement('div');
b.className = 'burst';
b.innerHTML = ['ğŸ’','ğŸ’—','ğŸ’•'][Math.floor(Math.random()*3)];
b.style.left = (cx + (Math.random()*300-150))+'px';
b.style.top  = (cy + (Math.random()*80-40))+'px';
b.style.color = `hsl(${330 + Math.random()*40},80%,70%)`;
b.style.fontSize = (18 + Math.random()*18)+'px';
document.body.appendChild(b);
setTimeout(()=>b.remove(),900);
}
for(let i=0;i<14;i++){
setTimeout(()=> spawnFloating('star'), i*80);
}
}

/* spawn floating elements - IMPROVED FLOWING EFFECT */
function spawnFloating(type){
const el = document.createElement('div');
el.className = type;
// Use emojis for transparent effect
if(type==='heart') el.innerHTML = ['ğŸ’•','ğŸ’—','ğŸ’'][Math.floor(Math.random()*3)];
if(type==='star') el.innerHTML = 'âœ¦';
if(type==='petal') el.innerHTML = 'ğŸŒ¸';

// Randomize start position
el.style.left = Math.random()*window.innerWidth + 'px';
// Randomize animation variables for smoother, non-repeating flow
const dur = (type==='petal' ? (15+Math.random()*10) : (18+Math.random()*7)); // Increased duration: 15-25s
const horizontalDrift = (Math.random() * 40 - 20) + 'vw'; 
const finalDrift = (Math.random() * 40 - 20) + 'vw';
const rot1 = (Math.random() * 30 - 15) + 'deg';
const rot2 = (Math.random() * 60 - 30) + 'deg';

el.style.setProperty('--dx', horizontalDrift);
el.style.setProperty('--dx2', finalDrift);
el.style.setProperty('--rot1', rot1);
el.style.setProperty('--rot2', rot2);

if(type==='petal') el.style.fontSize = (18 + Math.random()*26) + 'px';
else if(type==='heart') el.style.fontSize = (20 + Math.random()*30) + 'px';
else el.style.fontSize = (10 + Math.random()*16) + 'px';

el.style.animationName = 'floatUpSmooth'; 
el.style.animationDuration = dur+'s';
el.style.animationDelay = (-Math.random() * dur) + 's'; 

document.body.appendChild(el);
setTimeout(()=>el.remove(), (dur*1000)+500);
}

/* continuous spawns (slower for softer flow) */
setInterval(()=>spawnFloating('heart'), 600); // Reduced heart spawn rate
setInterval(()=>spawnFloating('petal'), 1200); // Reduced petal spawn rate
setInterval(()=>spawnFloating('star'), 1600); // Reduced star spawn rate

/* --------------------- Build language grid - SLOW REVEAL --------------------- */
function slowRevealLanguageGrid(){
    langGrid.innerHTML = '';
    const delayBetweenItems = 200; // Slower reveal

    iLoveYou.forEach((it, idx) => {
        const node = document.createElement('div');
        node.innerHTML = `<strong>${idx+1}. ${escapeHtml(it.lang)}:</strong> ${escapeHtml(it.text)}`;

        setTimeout(() => {
            langGrid.appendChild(node);
            node.style.animationDelay = '0s'; 
        }, idx * delayBetweenItems);
    });
}

/* --------------------- Shareable link & URL handling --------------------- */
function setShareableURL(from, to){
const base = location.origin + location.pathname;
const params = new URLSearchParams({from, to});
const url = `${base}?${params.toString()}`;
history.replaceState(null, '', url);
return url;
}
function getProposalURL(){ return setShareableURL(currentFrom, currentTo); }
function copyCurrentURL(){ copyText(location.href); }

/* --------------------- Music control (Autostart on first interaction) --------------------- */
function startMusic(){
  if (!musicEnabled) {
    musicEnabled = true;
    proposalMusic.currentTime = 0;
    proposalMusic.play().then(() => {
      // Success
    }).catch(e => {
      console.warn("Music play blocked:", e.name);
      musicEnabled = false;
    });
  }
}

/* --------------------- Flow functions --------------------- */
function fillExample(){ fromInput.value='Ivan'; toInput.value='Riya'; }

function generateProposal(){
const f = (fromInput.value || '').trim();
const t = (toInput.value || '').trim();
if(!f || !t){ alert('Please enter both names.'); return; }
currentFrom = f; currentTo = t;
setShareableURL(currentFrom, currentTo);

startMusic();

showScreen('s2');
const topMsg = `ğ‡á´‡ÊŸÊŸá´, ğŠÊá´€ ğ€á´€á´˜ ğ˜Êœá´€ ğ‚ÊŸÉªá´„á´‹ ğŠÊ€á´É¢Éª ğŒá´‡Ê€á´‡ ğ‹ÉªÊá´‡ ğÊŸs ğŸ’•`;
typeWriter(topMsg, msgTop, 100); // Slower typewriter speed

slowRevealLanguageGrid();
}

function showProposalScreen(){
    if (!poemReadOnce) {
        alert("Please read the poem (Read My Heart Out ğŸ“–) first!");
        return;
    }

    showScreen('s2a');
    try { proposalMusic.pause(); } catch(e){}

    const finalMsg = proposalText(currentTo, currentFrom);
    typeWriter(finalMsg, proposalMsg, 120); // Slower typewriter speed
}


function goBackHome(){
history.replaceState(null,'',location.pathname);
currentFrom=''; currentTo='';
poemReadOnce = false; // Reset state
try { proposalMusic.pause(); celebrationMusic.pause(); } catch(e){}
musicEnabled = false;
showScreen('s1');
}

/* Poem toggle with typewriter and dramatic glow */
function togglePoem(){
if(poemVisible){
  poemVisible = false;
  poemBox.classList.remove('show');
  poemBox.innerHTML = '';
} else {
  poemVisible = true;
  poemBox.innerHTML = ''; 
  poemBox.classList.add('show'); 
  smallBurst();
  typeWriter(poemText, poemBox, 100); // Slower typewriter speed
  try { proposalMusic.volume = 0.9; setTimeout(()=>proposalMusic.volume = 1.0, 1200); } catch(e){}

  // *** NEW FUNCTIONALITY: Enable the 'Ask' button after reading poem ***
  if (!poemReadOnce && askButton) {
      poemReadOnce = true;
      askButton.disabled = false;
      askButton.innerHTML = 'ğá´‹Êœ... [Click here to ask the final question!]';
  }
}
}

/* typewriter function plots text into element; supports \n */
function typeWriter(text, el, speed=36, cb){
el.innerHTML = '';
let i = 0;
function step(){
  if(i < text.length){
    const ch = text.charAt(i);
    el.innerHTML += (ch === '\n' ? '<br>' : escapeHtml(ch));
    i++;
    setTimeout(step, speed);
  } else {
    if(cb) cb();
  }
}
step();
}

/* --------------------- WhatsApp share --------------------- */
function shareWhatsApp(isCelebration = false){
const url = getProposalURL();
let message;
if(isCelebration){
message = `She said YES! ğŸ’ğŸ’– ${currentFrom} & ${currentTo} â€” Celebrate with us: ${url}`;
} else {
message = `Hi ${currentTo}! ${currentFrom} has a special proposal for you ğŸ’– Open here: ${url}`;
}
const link = 'https://wa.me/?text=' + encodeURIComponent(message);
window.open(link, '_blank');
}

/* --------------------- Celebration --------------------- */
function showCelebrate(){
try { proposalMusic.pause(); } catch(e){}

try { 
  celebrationMusic.currentTime = 0; 
  celebrationMusic.play().catch(e => {
    console.warn("Celebration Music play blocked (non-critical):", e.name);
  }); 
} catch(e){}

showScreen('s3');
spawnConfetti(80); // Slightly less confetti
for(let i=0;i<30;i++) setTimeout(()=>spawnFloating('heart'), i*150); // Slower burst
for(let i=0;i<20;i++){ setTimeout(()=>spawnBurstAtRandom(), i*100); } // Slower burst
}

function resetAll(){
  goBackHome();
  try { celebrationMusic.pause(); } catch(e){}
}

/* burst at random location */
function spawnBurstAtRandom(){
  const b = document.createElement('div');
  b.className = 'burst';
  b.innerHTML = ['ğŸ’–','ğŸ’“','ğŸ’'][Math.floor(Math.random()*3)];
  b.style.left = (Math.random()*window.innerWidth) + 'px';
  b.style.top  = (Math.random()*window.innerHeight*0.8) + 'px';
  b.style.color = `hsl(${320 + Math.random()*50},85%,70%)`;
  b.style.fontSize = (24 + Math.random()*38) + 'px';
  document.body.appendChild(b);
  setTimeout(()=> b.remove(), 1100);
}

/* confetti pieces */
function spawnConfetti(n){
for(let i=0;i<n;i++){
const c = document.createElement('div');
c.className = 'confettiPiece';
c.style.left = (Math.random()*100) + 'vw';
c.style.top = (-10 - Math.random()*20) + 'vh';
c.style.width = (8 + Math.random()*14) + 'px';
c.style.height = (8 + Math.random()*14) + 'px';
c.style.background = ['#ff6f9f','#ff006e','#00b3e6','#ffffff'][Math.floor(Math.random()*4)];
c.style.animationDuration = (8 + Math.random()*6) + 's'; // Slower fall time
c.style.animationDelay = (Math.random()*4) + 's';
document.body.appendChild(c);
setTimeout(()=> c.remove(), 15000);
}
}

/* --------------------- screenshot helper (simple) --------------------- */
function downloadScreenshot(){
alert('Use your device screenshot (mobile: power+volume, desktop: PrintScreen) for best quality.');
}

/* --------------------- Auto-fill from URL on load --------------------- */
(function initFromURL(){
const p = new URLSearchParams(location.search);
const f = p.get('from'); const t = p.get('to');
if(f) fromInput.value = f;
if(t) toInput.value = t;
if(f && t){ setTimeout(()=> generateProposal(), 350); }
})();

</script>  </body>
</html>